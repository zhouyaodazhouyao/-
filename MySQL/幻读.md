## 幻读指的是一个事务在前后两次查询同一个范围的时候，后一次查询看到了前一次查询没有看到的行。

说明：修改结果后被select语句用“当前读”看到，不能成为幻读。幻读仅仅指“新插入的行”。

### 幻读有什么问题？

![huan du](D:\Users\zhou_yao\workspace\just-for-review-and-zhuangB\MySQL\huan du.png)

#### 语义上

Session A在T1时刻就声明了，“我要把所有d=5的行锁住，不准别的事务进行读写操作”。然而，session B和session C的操作破坏了这个语义

####  数据一致性上



count()是一个聚合函数，对于返回的结果集，一行行判断，如果count函数的参数不是NULL，累计值就加1，否则不加，最后返回累计值。

- **count(主键id)**：遍历整张表，每行的id都取出来，返回给server层，server层判断字段不可空，按行累加；
- **count(1)**：遍历整张表，但是不取值，server层收到的所有行都是1，server层判断字段不为空，按行累加。之所以比count(主键)快，因为从引擎返回id会涉及到解析数据行，以及拷贝字段值的操作；
- **count(字段)**：如果字段定义为not null，逐行从记录里读出这个字段，server层判断字段不为空，按行累加；如果是允许为null的情况下，server层判断字段可为null，字段取出还需判断是否为null，再进行累加；
- **count(*)**：专门做了优化，不取值，按行累加。

**效率：count(字段) < count(主键 id) < count(1) ≈ count(*)**